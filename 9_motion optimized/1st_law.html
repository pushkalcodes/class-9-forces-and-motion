<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Newton's First Law of Motion - Physics in Motion</title>
    <!-- GSAP for realistic animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/CustomEase.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 50%, #2980b9 100%);
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Audio Control */
        #audio-control {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(52, 152, 219, 0.9);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .control-btn:hover {
            transform: scale(1.1);
            background: rgba(52, 152, 219, 1);
        }

        .control-btn.muted .unmute-icon { display: none; }
        .control-btn:not(.muted) .mute-icon { display: none; }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3rem;
            background: linear-gradient(45deg, #3498db, #e74c3c, #f39c12);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.95;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Demo Stage */
        .demo-stage {
            background: linear-gradient(to bottom, #1a2332, #2c3e50, #34495e);
            border-radius: 25px;
            min-height: 500px;
            position: relative;
            margin: 40px 0;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
            overflow: hidden;
            border: 4px solid rgba(52, 152, 219, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        /* Info Overlay */
        .info-overlay {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 15px;
            padding: 15px 20px;
            backdrop-filter: blur(10px);
            opacity: 0;
            transition: opacity 0.5s ease;
            z-index: 100;
            max-width: 500px;
        }

        .info-overlay.show {
            opacity: 1;
        }

        .info-title {
            font-size: 1.2rem;
            color: #3498db;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .info-text {
            font-size: 0.95rem;
            line-height: 1.5;
            opacity: 0.9;
        }

        /* Data Display */
        .data-display {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 12px 18px;
            backdrop-filter: blur(10px);
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            opacity: 0;
            transition: opacity 0.5s ease;
            z-index: 100;
        }

        .data-display.show {
            opacity: 1;
        }

        .data-item {
            margin: 4px 0;
            display: flex;
            justify-content: space-between;
            gap: 15px;
        }

        .data-label {
            color: #3498db;
        }

        .data-value {
            color: #f39c12;
            font-weight: 600;
        }

        /* Galileo's Inclined Plane Demo */
        .inclined-demo {
            display: none;
            position: relative;
            width: 100%;
            max-width: 800px;
            height: 400px;
        }

        .inclined-demo.active {
            display: block;
        }

        .plane-container {
            position: absolute;
            bottom: 50px;
            width: 100%;
            height: 300px;
        }

        .inclined-plane {
            position: absolute;
            bottom: 50px;
            width: 250px;
            height: 6px;
            background: linear-gradient(to right, #ecf0f1, #bdc3c7);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .left-plane {
            left: 100px;
            transform-origin: right bottom;
            transform: rotate(25deg);
            border: 3px solid #e74c3c;
        }

        .right-plane {
            right: 200px;
            transform-origin: left bottom;
            transform: rotate(-25deg);
            border: 3px solid #27ae60;
            transition: transform 1s ease;
        }

        .right-plane.flat {
            transform: rotate(0deg);
            width: 400px;
            right: 50px;
        }

        .right-plane.medium {
            transform: rotate(-12deg);
            width: 470px;
            right: -20px;
        }

        .right-plane.steep {
            transform: rotate(-25deg);
        }

        .marble {
            width: 25px;
            height: 25px;
            background: radial-gradient(circle at 30% 30%, #3498db, #2980b9, #1f618d);
            border-radius: 50%;
            position: absolute;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            transition: none;
            z-index: 10;
            left: 120px;
            bottom: 170px;
        }

        /* Velocity Vector */
        .velocity-arrow {
            position: absolute;
            width: 60px;
            height: 3px;
            background: #f39c12;
            transform-origin: left center;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 9;
        }

        .velocity-arrow::after {
            content: '';
            position: absolute;
            right: -8px;
            top: -4px;
            width: 0;
            height: 0;
            border-left: 10px solid #f39c12;
            border-top: 5px solid transparent;
            border-bottom: 5px solid transparent;
        }

        .velocity-arrow.show {
            opacity: 0.8;
        }

        .height-marker {
            position: absolute;
            width: 2px;
            background: #f39c12;
            opacity: 0.6;
            border: 1px dashed #f39c12;
        }

        .height-left {
            left: 100px;
            bottom: 56px;
            height: 114px;
        }

        .height-right {
            right: 200px;
            bottom: 56px;
            height: 114px;
            transition: all 1s ease;
        }

        .height-right.medium {
            right: -20px;
            height: 120px;
        }

        .height-right.flat {
            display: none;
        }

        .height-label {
            position: absolute;
            top: -25px;
            left: -15px;
            background: rgba(243, 156, 18, 0.9);
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        /* Car Inertia Demo */
        .car-demo {
            display: none;
            position: relative;
            width: 100%;
            height: 100%;
            align-items: center;
            justify-content: center;
        }

        .car-demo.active {
            display: flex;
        }

        .car-scene {
            position: relative;
            width: 100%;
            max-width: 600px;
            height: 300px;
        }

        .road-surface {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 60px;
            background: linear-gradient(to bottom, #34495e, #2c3e50);
            border-top: 3px solid #f39c12;
        }

        /* Road markings */
        .road-marking {
            position: absolute;
            bottom: 28px;
            width: 40px;
            height: 4px;
            background: rgba(255, 255, 255, 0.5);
        }

        .car-body {
            position: absolute;
            bottom: 60px;
            left: 100px;
            width: 200px;
            height: 80px;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            border-radius: 10px 30px 5px 5px;
            transition: all 0.5s ease;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .car-wheel {
            position: absolute;
            bottom: -15px;
            width: 30px;
            height: 30px;
            background: #2c3e50;
            border-radius: 50%;
            border: 3px solid #7f8c8d;
        }

        .car-wheel.front {
            right: 20px;
        }

        .car-wheel.rear {
            left: 20px;
        }

        .passenger {
            position: absolute;
            bottom: 20px;
            left: 80px;
            font-size: 40px;
            transition: all 0.5s ease;
        }

        .seatbelt {
            position: absolute;
            bottom: 25px;
            left: 95px;
            width: 3px;
            height: 35px;
            background: #2c3e50;
            transform: rotate(-20deg);
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .seatbelt.show {
            opacity: 1;
        }

        /* Force arrow for car */
        .force-arrow {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .force-arrow.show {
            opacity: 1;
        }

        .force-arrow-line {
            width: 80px;
            height: 4px;
            background: #e74c3c;
            position: relative;
        }

        .force-arrow-head {
            position: absolute;
            right: -10px;
            top: -6px;
            width: 0;
            height: 0;
            border-left: 15px solid #e74c3c;
            border-top: 8px solid transparent;
            border-bottom: 8px solid transparent;
        }

        .force-label {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.9rem;
            color: #e74c3c;
            font-weight: 600;
        }

        /* Coin Stack Demo */
        .coin-demo {
            display: none;
            position: relative;
            width: 100%;
            height: 100%;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 30px;
        }

        .coin-demo.active {
            display: flex;
        }

        .coin-stack {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .coin {
            width: 60px;
            height: 15px;
            background: linear-gradient(to bottom, #f1c40f, #f39c12);
            border: 2px solid #d68910;
            border-radius: 50%;
            margin-top: -5px;
            position: relative;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .coin:first-child {
            margin-top: 0;
        }

        .coin.bottom {
            z-index: 1;
        }

        .striker {
            position: absolute;
            left: -100px;
            bottom: 0;
            width: 60px;
            height: 15px;
            background: linear-gradient(to bottom, #e74c3c, #c0392b);
            border: 2px solid #a93226;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            opacity: 0;
        }

        /* Galileo Info Card */
        .galileo-card {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 20px;
            padding: 25px;
            margin: 30px 0;
            border: 3px solid rgba(52, 152, 219, 0.4);
            backdrop-filter: blur(10px);
        }

        .galileo-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .galileo-portrait {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #8e44ad, #3498db);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
        }

        .galileo-title {
            flex: 1;
        }

        .galileo-name {
            font-size: 1.4rem;
            color: #3498db;
            font-weight: 600;
        }

        .galileo-years {
            font-size: 1rem;
            color: #95a5a6;
        }

        .galileo-text {
            line-height: 1.8;
            opacity: 0.9;
        }

        /* Controls */
        .controls {
            text-align: center;
            margin: 40px 0;
        }

        .controls-title {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: #3498db;
            font-weight: 600;
        }

        .demo-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin: 25px 0;
        }

        .demo-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            border: none;
            color: white;
            padding: 14px 24px;
            border-radius: 30px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.3);
            min-width: 140px;
        }

        .demo-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(52, 152, 219, 0.4);
        }

        .demo-btn.active {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            box-shadow: 0 8px 20px rgba(231, 76, 60, 0.4);
        }

        /* Theory Section */
        .theory-section {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 25px;
            padding: 35px;
            margin: 35px 0;
            border: 3px solid rgba(52, 152, 219, 0.4);
            backdrop-filter: blur(15px);
        }

        .law-statement {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.15), rgba(231, 76, 60, 0.15));
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid #3498db;
        }

        .law-title {
            font-size: 1.4rem;
            color: #3498db;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .law-content {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #ecf0f1;
        }

        .examples-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .example-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .example-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.08);
        }

        .example-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            text-align: center;
        }

        .example-title {
            font-size: 1.2rem;
            color: #3498db;
            margin-bottom: 10px;
            font-weight: 600;
            text-align: center;
        }

        .example-text {
            font-size: 1rem;
            line-height: 1.6;
            opacity: 0.9;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.2rem;
            }
            
            .demo-stage {
                min-height: 400px;
                padding: 30px 20px;
            }
            
            .demo-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .examples-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 20px 15px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .header p {
                font-size: 1rem;
            }
            
            .demo-stage {
                min-height: 350px;
                padding: 20px 15px;
            }
            
            .theory-section {
                padding: 20px;
            }
            
            .demo-btn {
                min-width: 120px;
                padding: 12px 20px;
                font-size: 0.95rem;
            }
        }
    </style>
</head>
<body>
    <!-- Audio Control -->
    <div id="audio-control">
        <button id="mute-btn" class="control-btn">
            <span class="unmute-icon">🔊</span>
            <span class="mute-icon">🔇</span>
        </button>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Newton's First Law of Motion</h1>
            <p>The Law of Inertia: Objects at rest stay at rest, objects in motion stay in motion unless acted upon by an external force.</p>
        </div>

        <!-- Demo Stage -->
        <div class="demo-stage" id="stage">
            <!-- Info Overlay -->
            <div class="info-overlay" id="info-overlay">
                <div class="info-title">Animation Info</div>
                <div class="info-text" id="info-text">Select a demonstration to begin</div>
            </div>

            <!-- Data Display -->
            <div class="data-display" id="data-display">
                <div class="data-item">
                    <span class="data-label">Velocity:</span>
                    <span class="data-value" id="velocity-value">0 m/s</span>
                </div>
                <div class="data-item">
                    <span class="data-label">Height:</span>
                    <span class="data-value" id="height-value">0 m</span>
                </div>
                <div class="data-item">
                    <span class="data-label">Energy:</span>
                    <span class="data-value" id="energy-value">100%</span>
                </div>
            </div>

            <!-- Galileo's Inclined Plane -->
            <div class="inclined-demo" id="inclined-demo">
                <div class="plane-container">
                    <div class="inclined-plane left-plane"></div>
                    <div class="inclined-plane right-plane" id="right-plane"></div>
                    <div class="marble" id="marble"></div>
                    <div class="velocity-arrow" id="velocity-arrow"></div>
                    <div class="height-marker height-left">
                        <div class="height-label">h₁</div>
                    </div>
                    <div class="height-marker height-right" id="height-right">
                        <div class="height-label">h₂</div>
                    </div>
                </div>
            </div>

            <!-- Car Inertia Demo -->
            <div class="car-demo" id="car-demo">
                <div class="car-scene">
                    <div class="road-surface">
                        <div class="road-marking" style="left: 50px;"></div>
                        <div class="road-marking" style="left: 150px;"></div>
                        <div class="road-marking" style="left: 250px;"></div>
                        <div class="road-marking" style="left: 350px;"></div>
                        <div class="road-marking" style="left: 450px;"></div>
                    </div>
                    <div class="car-body" id="car">
                        <div class="force-arrow" id="force-arrow">
                            <div class="force-label" id="force-label">Brake Force</div>
                            <div class="force-arrow-line">
                                <div class="force-arrow-head"></div>
                            </div>
                        </div>
                        <div class="car-wheel front"></div>
                        <div class="car-wheel rear"></div>
                        <div class="passenger" id="passenger">🧑</div>
                        <div class="seatbelt" id="seatbelt"></div>
                    </div>
                </div>
            </div>

            <!-- Coin Stack Demo -->
            <div class="coin-demo" id="coin-demo">
                <div class="coin-stack" id="coin-stack">
                    <div class="coin"></div>
                    <div class="coin"></div>
                    <div class="coin"></div>
                    <div class="coin"></div>
                    <div class="coin bottom"></div>
                    <div class="striker" id="striker"></div>
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <div class="controls-title" id="demo-title">Explore the Law of Inertia</div>
            
            <div class="demo-buttons">
                <button class="demo-btn" onclick="playFullLesson()">📚 Complete Lesson</button>
                <button class="demo-btn" onclick="showGalileoDemo()">🎱 Galileo's Plane</button>
                <button class="demo-btn" onclick="showCarDemo()">🚗 Car Inertia</button>
                <button class="demo-btn" onclick="showCoinDemo()">🪙 Coin Stack</button>
                <button class="demo-btn" onclick="resetAllClick()">🔄 Reset</button>
            </div>
        </div>

        <!-- Galileo Info Card -->
        <div class="galileo-card">
            <div class="galileo-header">
                <div class="galileo-portrait">🔭</div>
                <div class="galileo-title">
                    <div class="galileo-name">Galileo Galilei</div>
                    <div class="galileo-years">1564 - 1642</div>
                </div>
            </div>
            <div class="galileo-text">
                Italian astronomer, physicist, and engineer who pioneered the experimental scientific method. 
                Through his inclined plane experiments, Galileo discovered that objects maintain constant velocity 
                without external forces - laying the groundwork for Newton's First Law. His telescopic observations 
                revolutionized astronomy, while his studies of motion transformed physics.
            </div>
        </div>

        <!-- Theory Section -->
        <div class="theory-section">
            <div class="law-statement">
                <div class="law-title">Newton's First Law of Motion</div>
                <div class="law-content">
                    An object remains in a state of rest or of uniform motion in a straight line unless 
                    compelled to change that state by an applied force. This tendency of objects to resist 
                    changes in their state of motion is called <strong>inertia</strong>, which is why this 
                    law is also known as the <strong>Law of Inertia</strong>.
                </div>
            </div>

            <div class="examples-grid">
                <div class="example-card">
                    <div class="example-icon">🚗</div>
                    <div class="example-title">Sudden Braking</div>
                    <div class="example-text">
                        When a car brakes suddenly, passengers lurch forward. Their bodies tend to continue 
                        moving at the original speed due to inertia. Seatbelts provide the force needed to 
                        decelerate with the car.
                    </div>
                </div>
                <div class="example-card">
                    <div class="example-icon">🚌</div>
                    <div class="example-title">Bus Starting</div>
                    <div class="example-text">
                        When a stationary bus suddenly starts moving, standing passengers fall backward. 
                        Their bodies resist the change from rest to motion, maintaining their state of rest 
                        while the bus floor moves forward.
                    </div>
                </div>
                <div class="example-card">
                    <div class="example-icon">🏎️</div>
                    <div class="example-title">Sharp Turns</div>
                    <div class="example-text">
                        During sharp turns at high speed, passengers are pushed to one side. Their bodies 
                        tend to continue in a straight line while the vehicle changes direction, demonstrating 
                        directional inertia.
                    </div>
                </div>
                <div class="example-card">
                    <div class="example-icon">🎱</div>
                    <div class="example-title">Galileo's Discovery</div>
                    <div class="example-text">
                        A marble on a frictionless inclined plane will roll down and up to the same height. 
                        If one side becomes horizontal, the marble continues forever, showing objects in 
                        motion stay in motion without friction.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Voice Teacher System
        class PhysicsTeacher {
            constructor() {
                this.isEnabled = globalAudioEnabled;
                this.currentUtterance = null;
                this.settings = { rate: 0.9, pitch: 1.0, volume: 0.85 };
                this.isDestroyed = false;
            }

            async speak(text, delay = 0) {
                if (!this.isEnabled || !text || this.isDestroyed) return;
                
                return new Promise((resolve) => {
                    setTimeout(() => {
                        if (this.isDestroyed) {
                            resolve();
                            return;
                        }
                        this.stop();
                        const utterance = new SpeechSynthesisUtterance(text);
                        Object.assign(utterance, this.settings);
                        
                        utterance.onend = resolve;
                        utterance.onerror = resolve;
                        
                        this.currentUtterance = utterance;
                        speechSynthesis.speak(utterance);
                    }, delay);
                });
            }

            stop() {
                speechSynthesis.cancel();
                this.currentUtterance = null;
            }

            destroy() {
                this.isDestroyed = true;
                this.stop();
                this.currentUtterance = null;
                this.settings = null;
            }
        }

        // Global state management
        let globalAudioEnabled = true;
        let currentTeacher = null;
        let isPlaying = false;
        let currentPlaneAngle = 'steep';
        let animationTimeline = null;
        let currentDemoAborted = false;
        let activeAnimations = [];
        let currentRunId = 0; // increments on every button click/demo start to guard UI updates

        // Function to create new animation timeline
        function createNewTimeline() {
            // Kill all previous animations
            if (animationTimeline) {
                animationTimeline.kill();
                animationTimeline = null;
            }
            // Kill all active animations
            activeAnimations.forEach(anim => {
                if (anim) anim.kill();
            });
            activeAnimations = [];
            // Kill all tweens
            gsap.killTweensOf("*");
            
            // Create new timeline
            const newTimeline = gsap.timeline();
            animationTimeline = newTimeline;
            return newTimeline;
        }

        // Function to add animation to tracking
        function trackAnimation(animation) {
            if (animation) {
                activeAnimations.push(animation);
            }
            return animation;
        }

        // Function to stop current demo
        function stopCurrentDemo() {
            currentDemoAborted = true;
            currentRunId++; // invalidate any pending UI updates from previous demos
            
            // Immediately hide all UI elements synchronously
            document.getElementById('info-overlay').classList.remove('show');
            document.getElementById('data-display').classList.remove('show');
            document.getElementById('info-text').textContent = '';
            document.getElementById('velocity-value').textContent = '0 m/s';
            document.getElementById('height-value').textContent = '0 m';
            document.getElementById('energy-value').textContent = '100%';
            
            // Stop teacher
            if (currentTeacher) {
                currentTeacher.destroy();
                currentTeacher = null;
            }
            
            // Kill all animations
            if (animationTimeline) {
                animationTimeline.kill();
                animationTimeline = null;
            }
            
            // Kill all tracked animations
            activeAnimations.forEach(anim => {
                if (anim) anim.kill();
            });
            activeAnimations = [];
            
            // Kill all GSAP tweens
            gsap.killTweensOf("*");
            
            // Hide all demos immediately
            document.querySelectorAll('.inclined-demo, .car-demo, .coin-demo').forEach(demo => {
                demo.classList.remove('active');
            });
            
            isPlaying = false;
        }

        // Function to check if demo should continue
        function shouldContinue() {
            return !currentDemoAborted;
        }

        // Function to stop current teacher and create new one
        function createNewTeacher() {
            // Destroy previous teacher if exists
            if (currentTeacher) {
                currentTeacher.destroy();
                currentTeacher = null;
            }
            // Reset abort flag
            currentDemoAborted = false;
            // Create new teacher instance
            currentTeacher = new PhysicsTeacher();
            return currentTeacher;
        }

        // Helper functions for UI updates
        function showInfo(text, runId) {
            if (runId !== currentRunId || !shouldContinue()) return;
            const overlay = document.getElementById('info-overlay');
            const infoText = document.getElementById('info-text');
            infoText.textContent = text;
            overlay.classList.add('show');
        }

        function hideInfo(runId) {
            if (runId !== currentRunId || !shouldContinue()) return;
            document.getElementById('info-overlay').classList.remove('show');
        }

        function showData(runId) {
            if (runId !== currentRunId || !shouldContinue()) return;
            document.getElementById('data-display').classList.add('show');
        }

        function hideData(runId) {
            if (runId !== currentRunId || !shouldContinue()) return;
            document.getElementById('data-display').classList.remove('show');
        }

        function updateData(velocity, height, energy, runId) {
            if (runId !== currentRunId || !shouldContinue()) return;
            document.getElementById('velocity-value').textContent = velocity;
            document.getElementById('height-value').textContent = height;
            document.getElementById('energy-value').textContent = energy;
        }

        // Initialize
        window.addEventListener('load', () => {
            const teacher = createNewTeacher();
            teacher.speak("Welcome to Newton's First Law! Let's explore how Galileo's experiments led to understanding inertia - the tendency of objects to resist changes in motion.");
            showInfo("Welcome! Select a demonstration to explore Newton's First Law of Motion", currentRunId);
        });

        // Complete Lesson
        async function playFullLesson() {
            // Stop any current demo
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(0);
            
            // Create new teacher for this demo
            const teacher = createNewTeacher();
            
            // Full reset first
            await resetAll();
            
            // Wait to ensure everything is cleared
            await wait(50);
            
            if (!shouldContinue()) return;
            
            updateTitle("📚 Complete First Law Lesson");
            
            // Another small wait before showing new info
            await wait(50);
            
            if (!shouldContinue()) return;
            
            const runId = currentRunId;
            showInfo("Starting complete lesson on Newton's First Law of Motion", runId);
            
            await teacher.speak("Welcome to Newton's First Law, also known as the Law of Inertia.");
            await wait(2000);
            if (!shouldContinue()) return;
            
            await teacher.speak("This law states that objects at rest stay at rest, and objects in motion stay in motion, unless acted upon by an external force.");
            await wait(3000);
            if (!shouldContinue()) return;
            
            await teacher.speak("Let's begin with Galileo's brilliant thought experiment that inspired this law.");
            await wait(2000);
            if (!shouldContinue()) return;
            
            // Galileo Demo
            await showGalileoDemoInternal(teacher);
            if (!shouldContinue()) return;
            await wait(2000);
            
            // Car Demo
            await teacher.speak("Now let's see how inertia affects us in everyday situations, like riding in a car.");
            await wait(2000);
            if (!shouldContinue()) return;
            await showCarDemoInternal(teacher);
            if (!shouldContinue()) return;
            await wait(2000);
            
            // Coin Demo
            await teacher.speak("Finally, here's a classic demonstration you can try at home.");
            await wait(1500);
            if (!shouldContinue()) return;
            await showCoinDemoInternal(teacher);
            if (!shouldContinue()) return;
            await wait(1000);
            
            await teacher.speak("That concludes our exploration of Newton's First Law. Remember: objects resist changes in their state of motion. This resistance is called inertia!");
            await wait(2000);
            if (!shouldContinue()) return;
            
            await teacher.speak("The more massive an object, the greater its inertia. That's why it's harder to push a heavy box than a light one!");
            
            showInfo("Lesson Complete! Newton's First Law: Objects resist changes in their state of motion");
            
            isPlaying = false;
        }

        // Galileo's Inclined Plane Demo
        async function showGalileoDemo() {
            // Stop any current demo
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(1);
            
            // Create new teacher for this demo
            const teacher = createNewTeacher();
            await showGalileoDemoInternal(teacher);
            
            isPlaying = false;
        }

        async function showGalileoDemoInternal(teacher) {
            // Full reset first
            await resetAll();
            
            // Wait to ensure everything is cleared
            await wait(50);
            
            if (!shouldContinue()) return;
            
            updateTitle("🎱 Galileo's Inclined Plane Experiment");
            
            document.getElementById('inclined-demo').classList.add('active');
            
            // Another small wait before showing new info
            await wait(50);
            
            if (!shouldContinue()) return;
            
            const runId = currentRunId;
            showInfo("Galileo's thought experiment: A ball rolling on frictionless inclined planes", runId);
            showData(runId);
            updateData("0 m/s", "1.14 m", "100%", runId);
            
            await teacher.speak("Watch carefully as we recreate Galileo's famous thought experiment. I'll release a marble from the left slope.");
            await wait(1000);
            
            const marble = document.getElementById('marble');
            const rightPlane = document.getElementById('right-plane');
            const heightRight = document.getElementById('height-right');
            const velocityArrow = document.getElementById('velocity-arrow');
            
            // GSAP Animation for steep slope
            showInfo("Steep slope: Ball climbs to same height on opposite side", runId);
            updateData("0 m/s", "1.14 m", "100%", runId);
            
            await wait(500);
            
            // Create realistic physics animation with GSAP
            animationTimeline = createNewTimeline();
            animationTimeline
                .to(marble, {
                    duration: 1.8,
                    left: 350,
                    bottom: 56,
                    rotation: -720,
                    ease: "power1.in",
                    onUpdate: function() {
                        if (currentDemoAborted) return;
                        const progress = this.progress();
                        const velocity = Math.round(progress * 9.8 * 10) / 10;
                        updateData(`${velocity} m/s`, `${(1.14 * (1 - progress)).toFixed(2)} m`, "100%", runId);
                    }
                })
                .to(marble, {
                    duration: 1.8,
                    left: 550,
                    bottom: 160,
                    rotation: -1320,
                    ease: "power1.out",
                    onUpdate: function() {
                        if (currentDemoAborted) return;
                        const progress = this.progress();
                        const velocity = Math.round((1 - progress) * 9.8 * 10) / 10;
                        updateData(`${velocity} m/s`, `${(progress * 1.14).toFixed(2)} m`, "100%", runId);
                    }
                });
            
            await wait(1500);
            if (!shouldContinue()) return;
            await teacher.speak("The marble rolls down into the valley and climbs up the opposite slope.");
            
            await wait(2500);
            if (!shouldContinue()) return;
            await teacher.speak("Notice it reaches exactly the same height on the right side! The heights h-one and h-two are equal.");
            
            await wait(2000);
            if (!shouldContinue()) return;
            
            // Reset for medium slope
            showInfo("Reducing slope angle: Ball travels further to reach same height", runId);
            await teacher.speak("Now I'll make the right slope less steep. Watch what happens.");
            await wait(1000);
            
            gsap.set(marble, { left: 120, bottom: 170, rotation: 0 });
            
            // Change to medium incline
            rightPlane.classList.remove('steep');
            rightPlane.classList.add('medium');
            heightRight.classList.add('medium');
            currentPlaneAngle = 'medium';
            
            await wait(1500);
            await teacher.speak("Releasing the marble again from the same height.");
            
            // GSAP animation for medium slope
            animationTimeline = createNewTimeline();
            animationTimeline
                .to(marble, {
                    duration: 1.5,
                    left: 350,
                    bottom: 56,
                    rotation: -720,
                    ease: "power1.in",
                    onUpdate: function() {
                        if (currentDemoAborted) return;
                        const progress = this.progress();
                        const velocity = Math.round(progress * 9.8 * 10) / 10;
                        updateData(`${velocity} m/s`, `${(1.14 * (1 - progress)).toFixed(2)} m`, "100%", runId);
                    }
                })
                .to(marble, {
                    duration: 3,
                    left: 780,
                    bottom: 150,
                    rotation: -1620,
                    ease: "power1.out",
                    onUpdate: function() {
                        if (currentDemoAborted) return;
                        const progress = this.progress();
                        const velocity = Math.round((1 - progress) * 9.8 * 10) / 10;
                        updateData(`${velocity} m/s`, `${(progress * 1.14).toFixed(2)} m`, "100%", runId);
                    }
                });
            
            await wait(2000);
            await teacher.speak("The marble travels further along the gentler slope...");
            
            await wait(3000);
            await teacher.speak("But still reaches the same vertical height! Conservation of energy at work.");
            
            await wait(2000);
            
            // Reset for flat
            showInfo("Horizontal plane: Ball continues forever trying to reach original height", runId);
            await teacher.speak("Finally, let's see what happens when the right side is completely flat.");
            await wait(1500);
            
            gsap.set(marble, { left: 120, bottom: 170, rotation: 0 });
            
            // Change to flat
            rightPlane.classList.remove('medium');
            rightPlane.classList.add('flat');
            heightRight.classList.remove('medium');
            heightRight.classList.add('flat');
            currentPlaneAngle = 'flat';
            
            await wait(1500);
            await teacher.speak("Releasing from the same height one more time.");
            
            // GSAP animation for flat surface
            animationTimeline = createNewTimeline();
            animationTimeline
                .to(marble, {
                    duration: 1.2,
                    left: 350,
                    bottom: 56,
                    rotation: -720,
                    ease: "power1.in",
                    onUpdate: function() {
                        if (currentDemoAborted) return;
                        const progress = this.progress();
                        const velocity = Math.round(progress * 9.8 * 10) / 10;
                        updateData(`${velocity} m/s`, `${(1.14 * (1 - progress)).toFixed(2)} m`, "100%");
                    }
                })
                .to(marble, {
                    duration: 4,
                    left: 900,
                    bottom: 56,
                    rotation: -2880,
                    ease: "none",
                    onUpdate: function() {
                        if (currentDemoAborted) return;
                        updateData("9.8 m/s", "0 m", "100%", runId);
                    }
                });
            
            await wait(2000);
            await teacher.speak("The marble keeps rolling and rolling! It will never stop trying to reach the original height.");
            
            await wait(3000);
            await teacher.speak("Without friction, it would continue forever. This is Newton's First Law - objects in motion stay in motion!");
            
            showInfo("Key Insight: Without friction, motion continues indefinitely!");
            
            await wait(1500);
        }

        // Car Inertia Demo
        async function showCarDemo() {
            // Stop any current demo
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(2);
            
            // Create new teacher for this demo
            const teacher = createNewTeacher();
            await showCarDemoInternal(teacher);
            
            isPlaying = false;
        }

        async function showCarDemoInternal(teacher) {
            // Full reset first
            await resetAll();
            
            // Wait to ensure everything is cleared
            await wait(50);
            
            if (!shouldContinue()) return;
            
            updateTitle("🚗 Inertia in a Moving Car");
            
            document.getElementById('car-demo').classList.add('active');
            
            // Another small wait before showing new info
            await wait(50);
            
            if (!shouldContinue()) return;
            
            const runId = currentRunId;
            showInfo("Car demonstration: Passengers experience inertia during acceleration and braking", runId);
            showData(runId);
            updateData("60 km/h", "N/A", "N/A", runId);
            
            await teacher.speak("Let's see how inertia affects passengers in a car. Watch the person inside carefully.");
            await wait(1500);
            
            const car = document.getElementById('car');
            const passenger = document.getElementById('passenger');
            const seatbelt = document.getElementById('seatbelt');
            const forceArrow = document.getElementById('force-arrow');
            const forceLabel = document.getElementById('force-label');
            
            showInfo("Sudden braking: Car stops but passenger's body continues forward", runId);
            await teacher.speak("First, when the driver suddenly applies the brakes...");
            await wait(1000);
            
            forceLabel.textContent = "Brake Force";
            forceArrow.classList.add('show');
            
            // GSAP animation for braking
            const brakingAnimation = trackAnimation(
                gsap.timeline()
                    .to(car, {
                        duration: 1.5,
                        left: 300,
                        ease: "power2.out",
                        onUpdate: function() {
                            if (currentDemoAborted) return;
                            const progress = this.progress();
                            const speed = Math.round(60 * (1 - progress));
                            updateData(`${speed} km/h`, "N/A", "N/A", runId);
                        }
                    })
                    .to(passenger, {
                        duration: 0.7,
                        x: 20,
                        rotation: 10,
                        ease: "power2.out"
                    }, "-=1.3")
                    .to(passenger, {
                        duration: 0.5,
                        x: 0,
                        rotation: 0,
                        ease: "back.out(2)"
                    })
            );
            
            await wait(800);
            await teacher.speak("The passenger lurches forward! The car stops, but the passenger's body wants to keep moving at the original speed.");
            
            await wait(2500);
            await teacher.speak("This is why seatbelts are crucial - they provide the force needed to stop your body with the car.");
            
            seatbelt.classList.add('show');
            showInfo("Seatbelt provides external force to overcome passenger's inertia", runId);
            await wait(2000);
            
            // Reset and show acceleration
            forceArrow.classList.remove('show');
            await teacher.speak("Now let's see what happens when a stopped car suddenly accelerates.");
            await wait(1500);
            
            gsap.set(car, { left: 100 });
            gsap.set(passenger, { x: 0, rotation: 0 });
            seatbelt.classList.remove('show');
            updateData("0 km/h", "N/A", "N/A", runId);
            
            showInfo("Sudden acceleration: Car moves forward but passenger's body stays at rest", runId);
            await wait(1500);
            await teacher.speak("The driver steps on the gas pedal...");
            await wait(1000);
            
            forceLabel.textContent = "Engine Force";
            forceArrow.classList.add('show');
            
            // GSAP animation for acceleration
            const accelerationAnimation = trackAnimation(
                gsap.timeline()
                    .to(car, {
                        duration: 1.5,
                        left: 350,
                        ease: "power2.in",
                        onUpdate: function() {
                            if (currentDemoAborted) return;
                            const progress = this.progress();
                            const speed = Math.round(80 * progress);
                            updateData(`${speed} km/h`, "N/A", "N/A", runId);
                        }
                    })
                    .to(passenger, {
                        duration: 0.7,
                        x: -15,
                        rotation: -10,
                        ease: "power2.out"
                    }, "-=1.3")
                    .to(passenger, {
                        duration: 0.5,
                        x: 0,
                        rotation: 0,
                        ease: "back.out(2)"
                    })
            );
            
            await wait(800);
            await teacher.speak("The passenger falls backward! The body at rest wants to stay at rest while the car accelerates forward.");
            
            await wait(2500);
            await teacher.speak("Both effects demonstrate inertia - objects resist changes in their motion.");
            showInfo("Key Principle: Bodies resist changes in velocity (speed or direction)");
            await wait(1500);
        }

        // Coin Stack Demo
        async function showCoinDemo() {
            // Stop any current demo
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(3);
            
            // Create new teacher for this demo
            const teacher = createNewTeacher();
            await showCoinDemoInternal(teacher);
            
            isPlaying = false;
        }

        async function showCoinDemoInternal(teacher) {
            // Full reset first
            await resetAll();
            
            // Wait to ensure everything is cleared
            await wait(50);
            
            if (!shouldContinue()) return;
            
            updateTitle("🪙 Coin Stack Inertia");
            
            document.getElementById('coin-demo').classList.add('active');
            
            // Another small wait before showing new info
            await wait(50);
            
            if (!shouldContinue()) return;
            
            const runId = currentRunId;
            showInfo("Coin stack experiment: Horizontal force affects only the bottom coin", runId);
            hideData(runId);
            
            await teacher.speak("Here's a classic demonstration of inertia. I have a stack of five coins.");
            await wait(1500);
            
            await teacher.speak("What happens if I strike the bottom coin sharply with another coin?");
            await wait(1500);
            
            const striker = document.getElementById('striker');
            const coins = document.querySelectorAll('.coin');
            const bottomCoin = document.querySelector('.coin.bottom');
            
            showInfo("Fast strike: Bottom coin experiences force, others maintain rest state", runId);
            await teacher.speak("Watch carefully as the striker hits the bottom coin...");
            await wait(1000);
            
            // GSAP animation for striker and coins
            const coinAnimation = trackAnimation(gsap.timeline());
            
            // Striker animation
            coinAnimation.to(striker, {
                duration: 0.3,
                left: 0,
                opacity: 1,
                ease: "power2.in"
            })
            .to(striker, {
                duration: 0.2,
                left: -50,
                opacity: 0,
                ease: "power2.out"
            })
            // Bottom coin shoots out
            .to(bottomCoin, {
                duration: 0.4,
                x: 200,
                opacity: 0,
                ease: "power2.out"
            }, "-=0.15")
            // Other coins fall with gravity
            .to(coins[0], {
                duration: 0.3,
                y: 10,
                ease: "power2.in"
            }, "-=0.1")
            .to(coins[1], {
                duration: 0.3,
                y: 10,
                ease: "power2.in"
            }, "-=0.28")
            .to(coins[2], {
                duration: 0.3,
                y: 10,
                ease: "power2.in"
            }, "-=0.28")
            .to(coins[3], {
                duration: 0.3,
                y: 10,
                ease: "power2.in"
            }, "-=0.28");
            
            await wait(1500);
            await teacher.speak("Amazing! The bottom coin shoots out horizontally...");
            
            showInfo("Result: Upper coins fall straight down - no horizontal motion!", runId);
            
            await wait(1500);
            await teacher.speak("But the other coins fall straight down! Their inertia keeps them at rest horizontally.");
            
            await wait(1500);
            await teacher.speak("Only gravity acts on them after the bottom coin is removed, so they fall vertically. Pure inertia in action!");
            
            showInfo("Physics Principle: Inertia maintains horizontal rest state while gravity causes vertical motion", runId);
            
            await wait(1500);
        }

        // Helper Functions
        async function resetAll() {
            // Kill any running GSAP animations
            if (animationTimeline) {
                animationTimeline.kill();
                animationTimeline = null;
            }
            gsap.killTweensOf("*");
            
            // Stop any current speech
            if (currentTeacher) {
                currentTeacher.stop();
            }
            
            // Hide all demos
            document.querySelectorAll('.inclined-demo, .car-demo, .coin-demo').forEach(demo => {
                demo.classList.remove('active');
            });
            
            // Reset info overlays and data displays
            hideInfo(currentRunId);
            hideData(currentRunId);
            updateTitle("Explore the Law of Inertia");
            updateData("0 m/s", "0 m", "100%", currentRunId);
            
            // Reset Galileo demo
            const marble = document.getElementById('marble');
            const rightPlane = document.getElementById('right-plane');
            const heightRight = document.getElementById('height-right');
            marble.style.animation = 'none';
            gsap.set(marble, { left: 120, bottom: 170, rotation: 0, x: 0, y: 0 });
            rightPlane.classList.remove('flat', 'medium');
            rightPlane.classList.add('steep');
            heightRight.classList.remove('flat', 'medium');
            currentPlaneAngle = 'steep';
            document.getElementById('velocity-arrow').classList.remove('show');
            
            // Reset car demo
            const car = document.getElementById('car');
            const passenger = document.getElementById('passenger');
            car.classList.remove('braking', 'accelerating');
            passenger.classList.remove('forward-jerk', 'backward-jerk');
            document.getElementById('seatbelt').classList.remove('show');
            document.getElementById('force-arrow').classList.remove('show');
            gsap.set(car, { left: 100 });
            gsap.set(passenger, { x: 0, rotation: 0 });
            
            // Reset coin demo
            const striker = document.getElementById('striker');
            const coins = document.querySelectorAll('.coin');
            striker.classList.remove('shoot');
            gsap.set(striker, { left: -100, opacity: 0 });
            coins.forEach(coin => {
                coin.classList.remove('hit', 'falling');
                gsap.set(coin, { x: 0, y: 0, opacity: 1 });
            });
            
            await wait(300);
        }

        function updateTitle(title) {
            document.getElementById('demo-title').textContent = title;
        }

        function setActiveButton(index) {
            document.querySelectorAll('.demo-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i === index);
            });
        }

        function wait(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Reset Button Handler - ensures same behavior as other buttons
        async function resetAllClick() {
            // Stop any running demo and invalidate previous run
            stopCurrentDemo();
            isPlaying = false;
            // Perform full reset
            await resetAll();
        }

        // Audio Control
        document.getElementById('mute-btn').addEventListener('click', () => {
            globalAudioEnabled = !globalAudioEnabled;
            document.getElementById('mute-btn').classList.toggle('muted', !globalAudioEnabled);
            
            // If audio is disabled, stop current speech
            if (!globalAudioEnabled && currentTeacher) {
                currentTeacher.stop();
            }
        });
    </script>
</body>
</html>